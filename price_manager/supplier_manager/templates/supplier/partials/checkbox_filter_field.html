{# checkbox_select_multiple_advanced.html #}
{% load crispy_forms_field %}

<div id="div_{{ field.auto_id }}"
     class="mb-3{% if field.errors %} has-error{% endif %}"
     data-checkbox-filter>

    {% if field.label %}
        <div class="d-flex justify-content-between align-items-center mb-2">
            <legend class="form-label fw-bold mb-0">
                {{ field.label }}
                {% if field.field.required %}
                    <span class="text-danger">*</span>
                {% endif %}
            </legend>
            <span class="badge rounded-pill text-bg-light border" data-selected-counter>
                –í—ã–±—Ä–∞–Ω–æ: 0
            </span>
        </div>
    {% endif %}

    {% if field.help_text %}
        <p class="form-text text-muted mb-2">
            {{ field.help_text|safe }}
        </p>
    {% endif %}

    {% if field.field.choices %}
        <div class="input-group input-group-sm mb-2">
            <span class="input-group-text">üîé</span>
            <input
                type="search"
                class="form-control"
                placeholder="–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫"
                data-checkbox-filter-search
            >
        </div>

        <div class="d-flex gap-2 mb-2">
            <button type="button" class="btn btn-sm btn-outline-secondary" data-checkbox-filter-select-all>
                –í—ã–±—Ä–∞—Ç—å –≤—Å—ë
            </button>
            <button type="button" class="btn btn-sm btn-outline-secondary" data-checkbox-filter-clear>
                –°–Ω—è—Ç—å –≤—Å—ë
            </button>
        </div>
    {% endif %}

    <div class="form-check-group border rounded p-2 bg-light-subtle" style="max-height: 260px; overflow: auto;">
        {% if field.field.choices %}
            {% for choice in field.field.choices %}
                <div class="form-check mb-2" data-checkbox-filter-item data-checkbox-filter-text="{{ choice.1|lower }}">
                    <input
                        type="checkbox"
                        name="{{ field.html_name }}"
                        value="{{ choice.0 }}"
                        id="{{ field.auto_id }}_{{ forloop.counter0 }}"
                        class="form-check-input{% if field.errors %} is-invalid{% endif %}"
                        {% if choice.0|stringformat:'' in field.value %}checked{% endif %}
                    >
                    <label class="form-check-label" for="{{ field.auto_id }}_{{ forloop.counter0 }}">
                        {{ choice.1 }}
                    </label>
                </div>
            {% endfor %}
        {% elif field.label %}
            <div>{{ field.label }} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
        {% else %}
            <div>–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö</div>
        {% endif %}
    </div>

    {% if field.errors %}
        <div class="invalid-feedback d-block">
            {% for error in field.errors %}
                {{ error }}
            {% endfor %}
        </div>
    {% endif %}
</div>
