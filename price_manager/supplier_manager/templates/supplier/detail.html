{% extends 'base.html' %}

{% block title %}
Поставщик: {{supplier.name}}
{% endblock %}

{% block body %}
<div class="container container-fluid mt-4 mb-5">
  <div class="container d-flex gap-4">
    <h1 class="mb-4">
      {{supplier.name}}
    </h1>
    <div class="container">
      <button type="button"
              class="btn btn-lg btn-success"
              title="Загрузка"
              data-bs-toggle="modal"
              data-bs-target="#modal-container"
              hx-get="{% url 'supplier-upload' supplier.pk %}"
              hx-target="#modal-container .modal-content"
              hx-swap="innerHTML">
        <i class="bi bi-upload"></i>
        <span>Загрузить файл</span>
      </button>
      <button type="button"
              class="btn btn-lg btn-primary"
              title="Загрузка"
              data-bs-toggle="modal"
              data-bs-target="#modal-container"
              hx-get="{% url 'pricemanager-create' supplier.pk %}"
              hx-target="#modal-container .modal-content"
              hx-swap="innerHTML">
        <i class="bi bi-plus"></i>
        <span>Добавить наценку</span>
      </button>
    </div>
  </div>
  <div class="container">
    <ul class="nav nav-tabs" id="funcTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" type="button" role="tab" aria-controls="products" aria-selected="true">Продукты</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="pricemanagers-tab" data-bs-toggle="tab" data-bs-target="#pricemanagers" type="button" role="tab" aria-controls="pricemanagers" aria-selected="false" >Наценки</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab" aria-controls="settings" aria-selected="false" >Настройки</button>
      </li>
    </ul>
    <div class="tab-content" id="funcTabsContent">
      <div class="tab-pane show active" id="products" role="tabpanel" aria-labelledby="products-tab">
        {% include "supplier/partials/detail_products_table_partial.html" %}
      </div>
      <div class="tab-pane" id="pricemanagers" role="tabpanel" aria-labelledby="pricemanagers-tab">
        {% include "supplier/partials/detail_pricemanagers_table_partial.html" %}
      </div>
      <div class="tab-pane" id="settings" role="tabpanel" aria-labelledby="settings-tab">
        {% include "supplier/partials/detail_settings_table_partial.html" %}
      </div>
    </div>
  </div>
</div>
<div id="modal-container" class="modal modal-xl fade" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
          <div class="container d-flex justify-content-center mb-4 mt-4">
            <div class="spinner-grow" role="status">
            </div>
            <div class="spinner-grow" role="status">
            </div>
            <div class="spinner-grow" role="status">
            </div>
          </div>
        </div>
    </div>
</div>
{% endblock %}


{% block script %}
<script>
function activateTabFromUrlHash() {
    // Check if a URL hash exists (e.g., #profile)
    if (window.location.hash) {
        // Get the hash, e.g., "#profile"
        const hash = window.location.hash;

        // Find the corresponding tab link using the href attribute
        const triggerEl = document.querySelector(`ul.nav-tabs button[data-bs-target="${hash}"]`);

        // If the tab link exists, activate it
        if (triggerEl) {
            // For Bootstrap 5, use the Tab API to show the tab
            // (Assumes Bootstrap JS is loaded and accessible via 'bootstrap')
            if (typeof bootstrap !== 'undefined') {
                const tab = new bootstrap.Tab(triggerEl);
                tab.show();
            } else {
                // For vanilla JS/older frameworks, you might manually
                // add an 'active' class and ensure content is visible.
                // The exact implementation depends on your specific library.
                triggerEl.click(); // A common simple approach for standard HTML/jQuery tabs
            }
        }
    }
}

// Call the function when the page loads
window.addEventListener('DOMContentLoaded', activateTabFromUrlHash);

document.querySelectorAll('ul.nav-tabs button[data-bs-toggle="tab"]').forEach(tabEl => {
    tabEl.addEventListener('shown.bs.tab', event => {
        history.pushState(null, '', event.target.getAttribute('data-bs-target'));
    });
});
</script>
{% endblock %}