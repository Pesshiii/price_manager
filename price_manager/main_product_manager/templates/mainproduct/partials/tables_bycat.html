{% load export_url from django_tables2 %}

<div id="mainproducts-table" class="table-area mb-5">
  <h1 class="mb-4">Главный прайс</h1>
  {% if categories or has_nulled %}
    {% if has_nulled %}
        <div class="table-responsive card p-3 shadow-sm overflow-visible">
          <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
            <h2 class="h5 mb-0">
              Без категории
            </h2>
            <span class="badge text-bg-light">
              {{ nulled_mp_count}}
            </span>
          </div>
          <div 
          hx-get="{% url "mainproduct-table-nocat"%}{% querystring %}"
          hx-trigger="load"
          hx-swap="outerHTML">
            Загрузка...
          </div>
        </div>
    {% endif %}
    {% partialdef category-table inline=True%}
      {% for category in categories %}
        {% if forloop.last and categories.has_next %}
          <div 
            hx-get="{% url "mainproducts" %}{% querystring page=categories.next_page_number %}"
            hx-trigger="revealed"
            hx-swap="afterend"
            class="table-responsive card p-3 shadow-sm overflow-visible mt-4">
        {% else %}
          <div class="table-responsive card p-3 shadow-sm overflow-visible mt-4">
          {% endif %} 
          {% if category %}
            <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
              <h2 class="h5 mb-0">
                {{ category.name|default:"" }}
              </h2>
              <span class="badge text-bg-light">
                {{ category.mp_count}}
              </span>
            </div>
            <div 
            hx-get="{% url "mainproduct-table-bycat" category_pk=category.pk %}{% querystring %}"
            hx-trigger="load"
            hx-swap="outerHTML">
              Загрузка...
            </div>
          {% endif %}
        </div>
      {% endfor %}
    {% endpartialdef %}
  {% else %}
    <div class="alert alert-info mb-0">
      Товары не найдены.
    </div>
  {% endif %}
</div>
