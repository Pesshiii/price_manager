<div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
                data-bs-auto-close="outside"
                aria-expanded="false">
          Столбцы
        </button>
        <div class="dropdown-menu dropdown-menu-end p-3" style="min-width: 360px; max-height: 55vh; overflow-y: auto;">
          <form hx-get="{% url 'mainproducts' %}"
                hx-target="#mainproducts-block"
                hx-swap="outerHTML"
                hx-trigger="change from:input[name='columns'] delay:5s">
            {% for key, values in request.GET.lists %}
              {% if key != 'columns' and key != 'page' %}
                {% for value in values %}
                  <input type="hidden" name="{{ key }}" value="{{ value }}">
                {% endfor %}
              {% endif %}
            {% endfor %}

            {% for group_label, group_choices in column_groups %}
              <div class="mb-2 {% if not forloop.last %}border-bottom pb-2{% endif %}">
                <div class="small fw-semibold text-muted mb-1">{{ group_label }}</div>
                {% for value, label in group_choices %}
                  <div class="form-check">
                    <input class="form-check-input"
                           type="checkbox"
                           value="{{ value }}"
                           name="columns"
                           id="columns_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}"
                           {% if value in selected_columns %}checked{% endif %}>
                    <label class="form-check-label small" for="columns_{{ forloop.parentloop.counter0 }}_{{ forloop.counter0 }}">
                      {{ label }}
                    </label>
                  </div>
                {% endfor %}
              </div>
            {% endfor %}
          </form>
        </div>
      </div>