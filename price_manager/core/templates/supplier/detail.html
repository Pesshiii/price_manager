{% extends 'base.html' %}

{% block title %}
Поставщик: {{supplier.name}}
{% endblock %}

{% block body %}
<div class="container-fluid mt-4 mb-5">
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
    <div>
      <h1 class="mb-1">{{supplier.name}}</h1>
      <p class="text-muted mb-0">Управляйте товарами и наценками поставщика в одном месте.</p>
    </div>
    <a class="btn btn-secondary" href="settings" role="button">Импорт</a>
  </div>

  <ul class="nav nav-tabs mb-3" id="supplier-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" type="button" role="tab" aria-controls="products" aria-selected="true">
        Товары
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="markups-tab" data-bs-toggle="tab" data-bs-target="#markups" type="button" role="tab" aria-controls="markups" aria-selected="false">
        Наценки
      </button>
    </li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane fade show active" id="products" role="tabpanel" aria-labelledby="products-tab">
      <div class="row">
        <!-- Блок фильтров -->
        <div class="col-lg-4 col-xl-3">
          <form method="get" class="card p-3 shadow-sm">
            <h5 class="mb-3">Фильтры</h5>

            <!-- Поиск по всем полям -->
            {% for item in filter.form %}
            <div class="container overflow-hidden">
              <label>{{item.label}}</label>
              <div class="mb-r">
                {{ item}}
              </div>
            </div>
            {%endfor%}

            <!-- Кнопки -->
            <div class=" d-flex gap-2 mt-5">
              <button type="submit" class="btn btn-primary">
                Искать
              </button>
            </div>
          </form>
        </div>

        <!-- Таблица -->
        <div class="col-lg-8 col-xl-9 mb-5">
          {% load export_url from django_tables2 %}

          <div class="table-responsive card p-3 shadow-sm overflow-visible">
            {% load django_tables2 %}
            {% render_table table %}
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="markups" role="tabpanel" aria-labelledby="markups-tab">
      <div class="card p-3 shadow-sm">
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
          <div>
            <h5 class="mb-1">Наценки поставщика</h5>
            <p class="text-muted mb-0">Создавайте и редактируйте правила расчёта цен.</p>
          </div>
          <a class="btn btn-primary" href="{% url 'price-manager-create' %}?supplier={{ supplier.id }}">
            Создать наценку
          </a>
        </div>
        <hr class="my-3">
        {% if price_managers %}
          <div class="list-group list-group-flush">
            {% for price_manager in price_managers %}
              <a href="{% url 'price-manager-update' price_manager.id %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-semibold">{{ price_manager.name }}</div>
                  <div class="text-muted small">Цель: {{ price_manager.get_dest_display }}</div>
                </div>
                <span class="text-muted small">Открыть</span>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-muted">Пока нет наценок. Создайте первую, чтобы задать правила расчёта цен.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
{% endblock %}
