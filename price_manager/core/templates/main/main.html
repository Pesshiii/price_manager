{% extends 'base.html' %}

{% block title %}
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
{% endblock %}

{% block style %}
  .hover-wrapper {
      position: relative;
      cursor: pointer;
    }
    .hover-card {
      position: absolute;
      top: 50%;            /* drop below the cell text  */
      left: 100%;
      z-index: 9;        /* above table borders       */
      display: none;
      width: 240px;
    }
    .hover-wrapper:hover .hover-card,
    .hover-wrapper:focus .hover-card {
      display: block;
    }
{% endblock %}

{% block body %}
<div class="row">
  <div class="col-md-4 card mt-5">
    <h2>–§–∏–ª—å—Ç—Ä—ã</h2>
    <form method="get" class="form" id="main-filter-form">
      {{ filter_form.media }}

      <div class="row mt-3">
        <div class="form-group">
          <label for="{{ filter_form.search.id_for_label }}">{{ filter_form.search.label }}</label>
          {{ filter_form.search }}
        </div>
      </div>

      <div class="row mt-3">
        <div class="form-group">
          <label for="{{ filter_form.anti_search.id_for_label }}">{{ filter_form.anti_search.label }}</label>
          {{ filter_form.anti_search }}
        </div>
      </div>

      {% if filter_form.available %}
      <div class="row mt-3">
        <div class="form-group">
          <label for="{{ filter_form.available.id_for_label }}">{{ filter_form.available.label }}</label>
          {{ filter_form.available }}
        </div>
      </div>
      {% endif %}

      <div id="dynamic-filter-options">
        {% include 'main/includes/dynamic_filters.html' %}
      </div>

      <div class="row mt-3">
          <div class="col-12">
              <button type="submit" class="btn btn-primary">
                üîç –ò—Å–∫–∞—Ç—å
              </button>
              <a href="{% url 'main-product-sync'%}" class="btn btn-success">
                <i class="bi bi-recycle"></i> –û–±–Ω–æ–≤–∏—Ç—å
              </a>
          </div>
      </div>
    </form>
  </div>
  <div class="container-fluid mt-4 mb-5 col-md-8">
    <h1 class="mb-4">–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∞–π—Å</h1>
    
      <!-- –¢–∞–±–ª–∏—Ü–∞ -->
      <div class="col-md-12 mb-5">
        {% load export_url from django_tables2 %}
    
        <div class="table-responsive card p-3 shadow-sm overflow-visible">
          {% load django_tables2 %}
          {% render_table table %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
  document.body.addEventListener('htmx:configRequest', (evt) => {
    evt.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
  });

  const enhanceSelect = (selector) => {
    const element = window.jQuery ? window.jQuery(selector) : null;
    if (element && element.length && element.select2) {
      element.select2({
        width: '100%',
        placeholder: element.data('placeholder') || '',
        allowClear: true,
        language: {
          noResults: () => '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
          searching: () => '–ü–æ–∏—Å–∫‚Ä¶'
        }
      });
    }
  };

  const initDynamicFilters = () => {
    enhanceSelect('#id_supplier');
    enhanceSelect('#id_manufacturer');
  };

  document.addEventListener('DOMContentLoaded', initDynamicFilters);

  document.body.addEventListener('htmx:afterSwap', (event) => {
    if (event.target && event.target.id === 'dynamic-filter-options') {
      initDynamicFilters();
    }
  });
</script>
{% endblock %}
