
{% with field_value=field.value options=available_options label=available_options_label collapsible=collapsible|default:True %}
<div id="{{ container_id }}" class="filter-toggle-section mt-3"{% if hx_swap_oob %} hx-swap-oob="true"{% endif %}>
  <div class="d-flex justify-content-between align-items-center">
    <span class="fw-semibold">{{ field.label }}</span>
    {% if collapsible %}
      <button
          class="btn btn-sm btn-outline-secondary"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#{{ collapse_id }}"
          aria-expanded="{% if field_value %}true{% else %}false{% endif %}"
          aria-controls="{{ collapse_id }}"
          data-filter-toggle="button"
          data-expanded-text="Скрыть"
          data-collapsed-text="Показать">
        {% if field_value %}Скрыть{% else %}Показать{% endif %}
      </button>
    {% endif %}
  </div>
  <div id="{{ collapse_id }}" class="mt-2{% if collapsible %} collapse{% if field_value %} show{% endif %}{% endif %}">
    {% if not is_category %}
      <div data-autocomplete-filter>
        <label for="{{ field.auto_id }}_search" class="form-label">{{ field.label }}</label>
        <input
            type="search"
            id="{{ field.auto_id }}_search"
            class="form-control form-control-sm"
            placeholder="Начните вводить значение"
            data-autocomplete-search
            data-ignore-auto-update="true"
            autocomplete="off"
        >
        <div class="autocomplete-suggestions d-none" data-autocomplete-suggestions></div>
        <div class="filter-tile-list mt-2" data-autocomplete-options>
          {% for choice in field %}
            <label class="filter-tile" data-option-item>
              {{ choice.tag }}
              <span data-option-label>{{ choice.choice_label }}</span>
            </label>
          {% empty %}
            <div class="small text-muted">Нет доступных значений</div>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <div data-category-filter>
        <label for="{{ field.auto_id }}_search" class="form-label">Поиск категории</label>
        <input
            type="search"
            id="{{ field.auto_id }}_search"
            class="form-control form-control-sm"
            placeholder="Начните вводить название категории"
            data-category-filter-search
            data-ignore-auto-update="true"
        >
        <div class="autocomplete-suggestions d-none" data-category-suggestions></div>
        {% include 'includes/category_tree_filter.html' with field=field category_tree=category_tree selected_categories=selected_categories %}
      </div>
    {% endif %}
    {% if options is not None %}
      <div class="mt-3">
        {% if options %}
          <div class="small text-muted mb-1">
            {{ label|default:'Доступные значения' }} ({{ options|length }}):
          </div>
          <div class="d-flex flex-wrap gap-1">
            {% for option in options %}
              <span class="badge bg-light text-dark border text-wrap">{{ option.name }}</span>
            {% endfor %}
          </div>
        {% else %}
          <div class="small text-muted">{{ label|default:'Доступные значения' }}: отсутствуют</div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
{% endwith %}
