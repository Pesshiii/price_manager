
{% with field_value=field.value options=available_options label=available_options_label collapsible=collapsible|default:True %}
<div id="{{ container_id }}" class="filter-toggle-section mt-3"{% if hx_swap_oob %} hx-swap-oob="true"{% endif %}>
  <div class="d-flex justify-content-between align-items-center">
    <span class="fw-semibold">{{ field.label }}</span>
    {% if collapsible %}
      <button
          class="btn btn-sm btn-outline-secondary"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#{{ collapse_id }}"
          aria-expanded="{% if field_value %}true{% else %}false{% endif %}"
          aria-controls="{{ collapse_id }}"
          data-filter-toggle="button"
          data-expanded-text="Скрыть"
          data-collapsed-text="Показать">
        {% if field_value %}Скрыть{% else %}Показать{% endif %}
      </button>
    {% endif %}
  </div>
  <div id="{{ collapse_id }}" class="mt-2{% if collapsible %} collapse{% if field_value %} show{% endif %}{% endif %}">
    {% if not is_category %}
      <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
      {{ field }}
    {% else %}
      {% include 'includes/category_tree_filter.html' with field=field category_tree=category_tree selected_categories=selected_categories %}
    {% endif %}
    {% if options is not None %}
      <div class="mt-3">
        {% if options %}
          <div class="small text-muted mb-1">
            {{ label|default:'Доступные значения' }} ({{ options|length }}):
          </div>
          <div class="d-flex flex-wrap gap-1">
            {% for option in options %}
              <span class="badge bg-light text-dark border text-wrap">{{ option.name }}</span>
            {% endfor %}
          </div>
        {% else %}
          <div class="small text-muted">{{ label|default:'Доступные значения' }}: отсутствуют</div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
{% endwith %}
